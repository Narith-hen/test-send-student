<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - Student Result System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-graduation-cap text-2xl"></i>
                    <span class="text-xl font-bold">Student Result System</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm">Welcome, <span id="userName" class="font-semibold"></span></span>
                    <a href="/logout" class="bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-all">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar & Content -->
    <div class="flex">
        <!-- Sidebar -->
        <aside class="bg-white w-64 min-h-screen shadow-lg">
            <nav class="p-4">
                <a href="/dashboard" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 text-gray-700 mb-2 transition-all">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="/upload" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 text-gray-700 mb-2 transition-all">
                    <i class="fas fa-upload"></i>
                    <span>Upload Results</span>
                </a>
                <a href="/students" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 text-gray-700 mb-2 transition-all">
                    <i class="fas fa-users"></i>
                    <span>Students</span>
                </a>
                <a href="/logs" class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 text-gray-700 mb-2 transition-all">
                    <i class="fas fa-history"></i>
                    <span>Email Logs</span>
                </a>
                <a href="/settings" class="flex items-center space-x-3 p-3 rounded-lg bg-gradient-to-r from-purple-600 to-blue-600 text-white mb-2">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-8">
                <i class="fas fa-cog mr-3"></i>Settings
            </h1>

            <!-- Email Configuration -->
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-envelope mr-2"></i>Email Configuration
                </h2>

                <form id="emailConfigForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-at mr-2"></i>Email Address
                        </label>
                        <input type="email" id="emailAddress" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="your-email@gmail.com">
                        <p class="text-sm text-gray-500 mt-1">This email will be used to send student results</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-key mr-2"></i>App Password
                        </label>
                        <input type="password" id="appPassword" required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            placeholder="Enter your app password">
                        <p class="text-sm text-gray-500 mt-1">Use an app-specific password, not your regular email password</p>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-2">
                            <i class="fas fa-info-circle mr-2"></i>How to get Gmail App Password:
                        </h3>
                        <ol class="list-decimal list-inside text-sm text-blue-700 space-y-1">
                            <li>Enable 2-factor authentication on your Google account</li>
                            <li>Go to <a href="https://myaccount.google.com/apppasswords" target="_blank" class="underline hover:text-blue-900">Google App Passwords</a></li>
                            <li>Select "Mail" and your device</li>
                            <li>Copy the 16-character password and paste it above</li>
                        </ol>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-purple-700 hover:to-blue-700 transition-all">
                        <i class="fas fa-save mr-2"></i>Save Configuration
                    </button>
                </form>

                <div id="emailMessage" class="mt-4 hidden"></div>
            </div>

            <!-- System Information -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-info-circle mr-2"></i>System Information
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
                        <p class="text-sm text-gray-600 mb-1">Version</p>
                        <p class="text-xl font-bold text-purple-600">1.0.0</p>
                    </div>

                    <div class="bg-gradient-to-r from-green-50 to-teal-50 p-4 rounded-lg border border-green-200">
                        <p class="text-sm text-gray-600 mb-1">Database</p>
                        <p class="text-xl font-bold text-green-600">SQLite</p>
                    </div>

                    <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-lg border border-orange-200">
                        <p class="text-sm text-gray-600 mb-1">Framework</p>
                        <p class="text-xl font-bold text-orange-600">Flask</p>
                    </div>

                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                        <p class="text-sm text-gray-600 mb-1">Mail Service</p>
                        <p class="text-xl font-bold text-blue-600">Flask-Mail</p>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h3 class="font-semibold text-yellow-800 mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Security Notes:
                    </h3>
                    <ul class="list-disc list-inside text-sm text-yellow-700 space-y-1">
                        <li>Never share your app password with anyone</li>
                        <li>Change your password regularly</li>
                        <li>Use environment variables for production deployment</li>
                        <li>Enable two-factor authentication on your email account</li>
                    </ul>
                </div>
            </div>

            <!-- Features Overview -->
            <div class="bg-white rounded-xl shadow-lg p-8 mt-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-star mr-2"></i>Features
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Bulk Email Sending</h3>
                            <p class="text-sm text-gray-600">Send results to multiple students with one click</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">CSV/Excel Upload</h3>
                            <p class="text-sm text-gray-600">Import student data from spreadsheets</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Email Templates</h3>
                            <p class="text-sm text-gray-600">Professional email templates with grades</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Analytics Dashboard</h3>
                            <p class="text-sm text-gray-600">View statistics and performance metrics</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Email Logs</h3>
                            <p class="text-sm text-gray-600">Track email delivery status and history</p>
                        </div>
                    </div>

                    <div class="flex items-start space-x-3">
                        <i class="fas fa-check-circle text-2xl text-green-600 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">Export Reports</h3>
                            <p class="text-sm text-gray-600">Download logs and reports as CSV</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Email configuration form
        document.getElementById('emailConfigForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('emailAddress').value;
            const password = document.getElementById('appPassword').value;
            const messageDiv = document.getElementById('emailMessage');

            try {
                const response = await fetch('/api/update-email-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (data.success) {
                    messageDiv.className = 'mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg';
                    messageDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>' + data.message;
                    messageDiv.classList.remove('hidden');

                    // Clear password field for security
                    document.getElementById('appPassword').value = '';
                } else {
                    messageDiv.className = 'mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                    messageDiv.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i>Failed to update configuration';
                    messageDiv.classList.remove('hidden');
                }
            } catch (error) {
                messageDiv.className = 'mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg';
                messageDiv.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i>An error occurred';
                messageDiv.classList.remove('hidden');
            }

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        });
    </script>
</body>
</html>
